---
title: 搬瓦工CN2 手动安装bbr加速
date: 2019-01-03 19:09:17
categories: 
- 科学上网
- VPS优化
tags: bbr加速安装
---

> **背景：**最近几天搬瓦工LA CN2的VPS上安装的ss服务及其慢，与刚完成安装时的速度相差极大，几乎网页打不开，于是测试一下在手动安装的bbr下是否会有改善（预期没有）。

**ps:** 悲伤的是即将过期的OVZ加FS加速，在此时还能保持35000kmbps以上、缓冲29s，4k 60秒开，而新购买的LA CN2+自带bbr此时已经网页都浏览不动（不知是否有其他原因）：

<!--more-->

![](ovz_fs.PNG)



### 1. Install new OS

找到VPS的KiwiVM面板，选择安装新的操作系统，这里选择不带bbr的centOS7：

![](install_new_os.PNG)





### 2. 安装bbr脚本

#### 2.1 安装wget

通过更新的SSH端口与root密码远程登录VPS，安装wget工具：

```
yum install wget
```

#### 2.2 下载并安装脚本 

以root身份在任意目录下执行下面的命令：

```
wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh
chmod +x bbr.sh
./bbr.sh
```

自动安装过程中如果当前OS的内核与bbr所需的内核不兼容会首先去下载最新的内核：

![](update_kernel.PNG)



更新完成之后验证是否成功，输入

```
uname -r
```

如果此时内核显示是4.10以上表示内核已经替换成功



查看bbr是否安装成功，输入：

```
lsmod | grep bbr
```

如果显示有tcp_bbr 即说明bbr安装成功



### 3. 安装ss服务与客户端

ss服务端的安装与客户端使用参考[ss服务安装与客户端使用](https://dpcfury.github.io/2018/12/26/%E6%90%AC%E7%93%A6%E5%B7%A5openVZ%E8%BD%ACKVM%EF%BC%8Css%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8A%A0%E9%80%9F%E6%B5%8B%E8%AF%95/ "ss安装")



### 4. 迁移机房测试

由于在DC8机房中各种测试下速度奇慢无比，索性更换到了DC3机房，发现速度明显恢复正常（希望不是最近GWF2.0要出来了），速度能够达到25000kmbps（夜晚9.10分左右）：

![](DC3_test.PNG)











